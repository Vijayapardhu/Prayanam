{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<style>
    .admin-sidebar {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .admin-sidebar a {
        transition: all 0.3s ease;
    }
    .admin-sidebar a:hover {
        transform: translateX(5px);
    }
    .admin-sidebar a.active {
        background: rgba(255, 255, 255, 0.2);
        transform: translateX(5px);
    }
    .notification-badge {
        animation: pulse 2s infinite;
    }
    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }
    .stat-card {
        transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    }
    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-100 flex">
    <!-- Sidebar -->
    <div class="admin-sidebar w-64 min-h-screen text-white">
        <div class="p-6">
            <div class="flex items-center mb-8">
                <i class="fas fa-shield-alt text-3xl mr-3"></i>
                <h2 class="text-2xl font-bold">Admin Panel</h2>
            </div>
            <nav class="space-y-2">
                <a href="{% url 'admin_dashboard:dashboard' %}" class="flex items-center px-4 py-3 rounded-lg hover:bg-white hover:bg-opacity-20 {% if request.resolver_match.url_name == 'dashboard' %}bg-white bg-opacity-20{% endif %}">
                    <i class="fas fa-tachometer-alt mr-3"></i>Dashboard
                </a>
                <a href="{% url 'admin_dashboard:user_management' %}" class="flex items-center px-4 py-3 rounded-lg hover:bg-white hover:bg-opacity-20 {% if 'user' in request.resolver_match.url_name %}bg-white bg-opacity-20{% endif %}">
                    <i class="fas fa-users mr-3"></i>Users
                </a>
                <a href="{% url 'admin_dashboard:place_management' %}" class="flex items-center px-4 py-3 rounded-lg hover:bg-white hover:bg-opacity-20 {% if 'place' in request.resolver_match.url_name %}bg-white bg-opacity-20{% endif %}">
                    <i class="fas fa-map-marker-alt mr-3"></i>Places
                </a>
                <a href="{% url 'admin_dashboard:package_management' %}" class="flex items-center px-4 py-3 rounded-lg hover:bg-white hover:bg-opacity-20 {% if 'package' in request.resolver_match.url_name %}bg-white bg-opacity-20{% endif %}">
                    <i class="fas fa-box mr-3"></i>Packages
                </a>
                <a href="{% url 'admin_dashboard:booking_management' %}" class="flex items-center px-4 py-3 rounded-lg hover:bg-white hover:bg-opacity-20 {% if 'booking' in request.resolver_match.url_name %}bg-white bg-opacity-20{% endif %}">
                    <i class="fas fa-calendar-check mr-3"></i>Bookings
                </a>
                <a href="{% url 'admin_dashboard:feedback_management' %}" class="flex items-center px-4 py-3 rounded-lg hover:bg-white hover:bg-opacity-20 {% if 'feedback' in request.resolver_match.url_name %}bg-white bg-opacity-20{% endif %}">
                    <i class="fas fa-comments mr-3"></i>Feedback
                </a>
                <a href="{% url 'admin_dashboard:analytics' %}" class="flex items-center px-4 py-3 rounded-lg hover:bg-white hover:bg-opacity-20 {% if 'analytics' in request.resolver_match.url_name %}bg-white bg-opacity-20{% endif %}">
                    <i class="fas fa-chart-bar mr-3"></i>Analytics
                </a>
                <a href="{% url 'admin_dashboard:notifications' %}" class="flex items-center px-4 py-3 rounded-lg hover:bg-white hover:bg-opacity-20 {% if 'notifications' in request.resolver_match.url_name %}bg-white bg-opacity-20{% endif %}">
                    <i class="fas fa-bell mr-3"></i>Notifications
                    <span id="notification-count" class="ml-auto bg-red-500 text-white text-xs rounded-full px-2 py-1 notification-badge" style="display: none;">0</span>
                </a>
                <a href="{% url 'admin_dashboard:bulk_operations' %}" class="flex items-center px-4 py-3 rounded-lg hover:bg-white hover:bg-opacity-20 {% if 'bulk' in request.resolver_match.url_name %}bg-white bg-opacity-20{% endif %}">
                    <i class="fas fa-tasks mr-3"></i>Bulk Operations
                </a>
                <a href="{% url 'admin_dashboard:data_export' %}" class="flex items-center px-4 py-3 rounded-lg hover:bg-white hover:bg-opacity-20 {% if 'export' in request.resolver_match.url_name %}bg-white bg-opacity-20{% endif %}">
                    <i class="fas fa-download mr-3"></i>Data Export
                </a>
                <a href="{% url 'admin_dashboard:system_settings' %}" class="flex items-center px-4 py-3 rounded-lg hover:bg-white hover:bg-opacity-20 {% if 'settings' in request.resolver_match.url_name %}bg-white bg-opacity-20{% endif %}">
                    <i class="fas fa-cog mr-3"></i>Settings
                </a>
                <a href="{% url 'admin_dashboard:audit_logs' %}" class="flex items-center px-4 py-3 rounded-lg hover:bg-white hover:bg-opacity-20 {% if 'audit' in request.resolver_match.url_name %}bg-white bg-opacity-20{% endif %}">
                    <i class="fas fa-history mr-3"></i>Audit Logs
                </a>
            </nav>
        </div>
        
        <!-- User Info -->
        <div class="absolute bottom-0 left-0 right-0 p-6 border-t border-white border-opacity-20">
            <div class="flex items-center space-x-3">
                <img src="{{ user.profile_picture.url|default:'/static/images/default-avatar.png' }}" alt="Profile" class="h-10 w-10 rounded-full border-2 border-white border-opacity-30">
                <div>
                    <p class="text-sm font-medium">{{ user.username }}</p>
                    <p class="text-xs text-white text-opacity-70">Administrator</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="flex-1 flex flex-col">
        <!-- Header -->
        <div class="bg-white shadow-sm border-b">
            <div class="px-6 py-4">
                <div class="flex justify-between items-center">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900">{% block page_title %}Admin Dashboard{% endblock %}</h1>
                        <p class="text-gray-600">{% block page_description %}Manage your application{% endblock %}</p>
                    </div>
                    <div class="flex items-center space-x-4">
                        <!-- Notifications -->
                        <div class="relative">
                            <button id="notification-btn" class="relative p-2 text-gray-600 hover:text-gray-900">
                                <i class="fas fa-bell text-xl"></i>
                                <span id="notification-badge" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center" style="display: none;">0</span>
                            </button>
                        </div>
                        
                        <!-- Search -->
                        <div class="relative">
                            <input type="text" placeholder="Search..." class="w-64 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <i class="fas fa-search absolute right-3 top-3 text-gray-400"></i>
                        </div>
                        
                        <!-- User Menu -->
                        <div class="relative">
                            <button onclick="toggleUserMenu()" class="flex items-center space-x-2 text-gray-700 hover:text-gray-900">
                                <img src="{{ user.profile_picture.url|default:'/static/images/default-avatar.png' }}" alt="Profile" class="h-8 w-8 rounded-full">
                                <span class="text-sm font-medium">{{ user.username }}</span>
                                <i class="fas fa-chevron-down text-xs"></i>
                            </button>
                            
                            <!-- User Dropdown -->
                            <div id="userMenu" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50 hidden">
                                <a href="{% url 'accounts:profile' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                    <i class="fas fa-user mr-2"></i>Profile
                                </a>
                                <a href="{% url 'accounts:settings' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                    <i class="fas fa-cog mr-2"></i>Settings
                                </a>
                                <div class="border-t border-gray-100"></div>
                                <a href="{% url 'accounts:logout' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                    <i class="fas fa-sign-out-alt mr-2"></i>Logout
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page Content -->
        <div class="flex-1 p-6">
            {% block admin_content %}
            <!-- Content will be inserted here -->
            {% endblock %}
        </div>
    </div>
</div>

<!-- Notification Panel -->
<div id="notificationPanel" class="fixed right-4 top-20 w-80 bg-white rounded-lg shadow-lg z-50 hidden">
    <div class="p-4 border-b border-gray-200">
        <div class="flex items-center justify-between">
            <h3 class="text-lg font-semibold text-gray-900">Notifications</h3>
            <button onclick="closeNotificationPanel()" class="text-gray-400 hover:text-gray-600">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>
    <div class="p-4">
        <div id="notificationList">
            <!-- Notifications will be loaded here -->
        </div>
    </div>
</div>

<script>
// Load notification count
function loadNotificationCount() {
    fetch('{% url "admin_dashboard:get_notification_count" %}')
        .then(response => response.json())
        .then(data => {
            const badge = document.getElementById('notification-badge');
            const count = document.getElementById('notification-count');
            if (data.count > 0) {
                badge.style.display = 'flex';
                count.style.display = 'inline';
                badge.textContent = data.count;
                count.textContent = data.count;
            } else {
                badge.style.display = 'none';
                count.style.display = 'none';
            }
        });
}

// Toggle user menu
function toggleUserMenu() {
    const menu = document.getElementById('userMenu');
    menu.classList.toggle('hidden');
}

// Close user menu when clicking outside
document.addEventListener('click', function(event) {
    const userMenu = document.getElementById('userMenu');
    const userButton = event.target.closest('button');
    
    if (!userButton || !userButton.onclick || userButton.onclick.toString().indexOf('toggleUserMenu') === -1) {
        userMenu.classList.add('hidden');
    }
});

// Toggle notification panel
document.getElementById('notification-btn').addEventListener('click', function() {
    const panel = document.getElementById('notificationPanel');
    panel.classList.toggle('hidden');
    
    if (!panel.classList.contains('hidden')) {
        loadNotifications();
    }
});

// Close notification panel
function closeNotificationPanel() {
    document.getElementById('notificationPanel').classList.add('hidden');
}

// Load notifications
function loadNotifications() {
    // This would typically load actual notifications
    document.getElementById('notificationList').innerHTML = `
        <div class="text-center py-4">
            <i class="fas fa-bell text-2xl text-gray-300 mb-2"></i>
            <p class="text-gray-500">No new notifications</p>
        </div>
    `;
}

// Initialize dashboard
document.addEventListener('DOMContentLoaded', function() {
    loadNotificationCount();
    
    // Set up auto-refresh for notifications
    setInterval(loadNotificationCount, 30000); // Refresh every 30 seconds
});
</script>
{% endblock %}
