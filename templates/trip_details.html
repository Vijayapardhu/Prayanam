{% extends 'base.html' %}

{% block title %}Trip Details - {{ package.name }} | Prayanam{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50">
    <!-- Header Section -->
    <div class="bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 text-white py-8">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold mb-2">{{ package.name }}</h1>
                    <p class="text-blue-100">{{ package.place.name }} • {{ package.duration_days }} Days</p>
                </div>
                <div class="text-right">
                    <div class="text-2xl font-bold">₹{{ package.base_price }}</div>
                    <div class="text-sm text-blue-100">Starting Price</div>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Main Content -->
            <div class="lg:col-span-2 space-y-8">
                <!-- Date Selection & Price Calculator -->
                <div class="bg-white rounded-2xl shadow-xl p-8">
                    <h2 class="text-2xl font-bold mb-6 text-gray-900">Plan Your Trip</h2>
                    
                    <form id="trip-form" class="space-y-6">
                        <!-- Date Selection -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="start-date" class="block text-sm font-semibold text-gray-700 mb-3">Start Date</label>
                                <input type="date" id="start-date" name="start_date" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                       min="{{ today|date:'Y-m-d' }}" 
                                       title="Select your trip start date"
                                       placeholder="Choose start date">
                            </div>
                            <div>
                                <label for="end-date" class="block text-sm font-semibold text-gray-700 mb-3">End Date</label>
                                <input type="date" id="end-date" name="end_date" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50" 
                                       readonly
                                       title="Trip end date (automatically calculated)"
                                       placeholder="End date will be calculated">
                            </div>
                        </div>

                        <!-- Group Size -->
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-3">Number of Travelers</label>
                            <div class="flex items-center space-x-4">
                                <button type="button" id="decrease-group" class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center hover:bg-gray-300 transition" title="Decrease group size">
                                    <i class="fas fa-minus text-gray-600"></i>
                                </button>
                                <span id="group-size" class="text-2xl font-bold text-gray-900 min-w-[60px] text-center">2</span>
                                <button type="button" id="increase-group" class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center hover:bg-gray-300 transition" title="Increase group size">
                                    <i class="fas fa-plus text-gray-600"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Food Preferences -->
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-3">Food Preferences</label>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <label class="flex items-center p-4 border border-gray-200 rounded-lg cursor-pointer hover:border-blue-500 transition">
                                    <input type="radio" name="food_preference" value="veg" class="mr-3" checked>
                                    <div>
                                        <div class="font-semibold text-gray-900">Vegetarian</div>
                                        <div class="text-sm text-gray-600">Pure vegetarian meals</div>
                                    </div>
                                </label>
                                <label class="flex items-center p-4 border border-gray-200 rounded-lg cursor-pointer hover:border-blue-500 transition">
                                    <input type="radio" name="food_preference" value="non_veg" class="mr-3">
                                    <div>
                                        <div class="font-semibold text-gray-900">Non-Vegetarian</div>
                                        <div class="text-sm text-gray-600">Includes meat & fish</div>
                                    </div>
                                </label>
                                <label class="flex items-center p-4 border border-gray-200 rounded-lg cursor-pointer hover:border-blue-500 transition">
                                    <input type="radio" name="food_preference" value="mixed" class="mr-3">
                                    <div>
                                        <div class="font-semibold text-gray-900">Mixed</div>
                                        <div class="text-sm text-gray-600">Both veg & non-veg options</div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Price Breakdown -->
                        <div class="bg-gray-50 rounded-lg p-6">
                            <h3 class="text-lg font-semibold mb-4">Price Breakdown</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span>Base Price (per person)</span>
                                    <span>₹{{ package.base_price }}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Seasonal Adjustment</span>
                                    <span id="seasonal-adjustment">₹0</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Group Discount</span>
                                    <span id="group-discount">₹0</span>
                                </div>
                                                                 <div class="flex justify-between">
                                     <span>Food Package</span>
                                     <span id="food-cost">₹500</span>
                                 </div>
                                                                 <div class="border-t pt-3 flex justify-between font-bold text-lg">
                                     <span>Total per person</span>
                                     <span id="total-per-person">₹{{ package.base_price|add:500 }}</span>
                                 </div>
                                 <div class="border-t pt-3 flex justify-between font-bold text-xl text-blue-600">
                                     <span>Total for group</span>
                                     <span id="total-group">₹{{ package.base_price|add:package.base_price|add:1000 }}</span>
                                 </div>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Trip Summary (shown when dates are selected) -->
                <div id="trip-summary" class="bg-white rounded-2xl shadow-xl p-8 hidden">
                    <h2 class="text-2xl font-bold mb-6 text-gray-900">Your Trip Summary</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div class="bg-blue-50 rounded-lg p-4">
                            <h3 class="font-semibold text-gray-900 mb-2">Trip Details</h3>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Package:</span>
                                    <span class="font-medium">{{ package.name }}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Destination:</span>
                                    <span class="font-medium">{{ package.place.name }}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Duration:</span>
                                    <span class="font-medium">{{ package.duration_days }} Days</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Group Size:</span>
                                    <span class="font-medium" id="summary-group-size">2 People</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-green-50 rounded-lg p-4">
                            <h3 class="font-semibold text-gray-900 mb-2">Travel Dates</h3>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Start Date:</span>
                                    <span class="font-medium" id="summary-start-date">-</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">End Date:</span>
                                    <span class="font-medium" id="summary-end-date">-</span>
                                </div>
                                                                 <div class="flex justify-between">
                                     <span class="text-gray-600">Food Preference:</span>
                                     <span class="font-medium" id="summary-food">VEGETARIAN</span>
                                 </div>
                                                                 <div class="flex justify-between">
                                     <span class="text-gray-600">Total Price:</span>
                                     <span class="font-bold text-lg text-blue-600" id="summary-total">₹{{ package.base_price|add:package.base_price|add:500 }}</span>
                                 </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-yellow-50 rounded-lg p-4 mb-6">
                        <h3 class="font-semibold text-gray-900 mb-2">What's Included in Your Trip</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                            <ul class="space-y-1">
                                <li><i class="fas fa-check text-green-500 mr-2"></i>Professional tour guide</li>
                                <li><i class="fas fa-check text-green-500 mr-2"></i>All meals (breakfast, lunch, dinner)</li>
                                <li><i class="fas fa-check text-green-500 mr-2"></i>Comfortable accommodation</li>
                            </ul>
                            <ul class="space-y-1">
                                <li><i class="fas fa-check text-green-500 mr-2"></i>Transportation throughout the trip</li>
                                <li><i class="fas fa-check text-green-500 mr-2"></i>All entry fees and permits</li>
                                <li><i class="fas fa-check text-green-500 mr-2"></i>24/7 support during the trip</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Detailed Itinerary -->
                <div class="bg-white rounded-2xl shadow-xl p-8">
                    <h2 class="text-2xl font-bold mb-6 text-gray-900">Detailed Itinerary</h2>
                    
                    <div class="space-y-6">
                        {% for day in "123456789"|make_list %}
                        {% if forloop.counter <= package.duration_days %}
                        <div class="border border-gray-200 rounded-lg p-6">
                            <div class="flex items-center mb-4">
                                <div class="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold mr-4">
                                    {{ forloop.counter }}
                                </div>
                                <h3 class="text-xl font-semibold">Day {{ forloop.counter }}</h3>
                            </div>
                            
                            <!-- Morning Activities -->
                            <div class="mb-4">
                                <h4 class="font-semibold text-gray-900 mb-2 flex items-center">
                                    <i class="fas fa-sun text-yellow-500 mr-2"></i>Morning
                                </h4>
                                <div class="bg-yellow-50 rounded-lg p-4">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="font-medium">Sunrise Viewpoint</span>
                                        <span class="text-sm text-gray-600">6:00 AM - 8:00 AM</span>
                                    </div>
                                    <p class="text-gray-700 text-sm">Experience the breathtaking sunrise from the best viewpoint in {{ package.place.name }}. Perfect for photography and meditation.</p>
                                    <div class="mt-2 flex items-center text-sm text-gray-600">
                                        <i class="fas fa-map-marker-alt mr-1"></i>
                                        <span>Sunrise Point, {{ package.place.name }}</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Afternoon Activities -->
                            <div class="mb-4">
                                <h4 class="font-semibold text-gray-900 mb-2 flex items-center">
                                    <i class="fas fa-cloud-sun text-orange-500 mr-2"></i>Afternoon
                                </h4>
                                <div class="bg-orange-50 rounded-lg p-4">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="font-medium">Local Sightseeing</span>
                                        <span class="text-sm text-gray-600">12:00 PM - 4:00 PM</span>
                                    </div>
                                    <p class="text-gray-700 text-sm">Explore the main attractions and cultural sites of {{ package.place.name }} with our expert guide.</p>
                                    <div class="mt-2 flex items-center text-sm text-gray-600">
                                        <i class="fas fa-map-marker-alt mr-1"></i>
                                        <span>City Center, {{ package.place.name }}</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Evening Activities -->
                            <div>
                                <h4 class="font-semibold text-gray-900 mb-2 flex items-center">
                                    <i class="fas fa-moon text-purple-500 mr-2"></i>Evening
                                </h4>
                                <div class="bg-purple-50 rounded-lg p-4">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="font-medium">Sunset & Dinner</span>
                                        <span class="text-sm text-gray-600">6:00 PM - 9:00 PM</span>
                                    </div>
                                    <p class="text-gray-700 text-sm">Enjoy a romantic sunset followed by a delicious local dinner with traditional cuisine.</p>
                                    <div class="mt-2 flex items-center text-sm text-gray-600">
                                        <i class="fas fa-map-marker-alt mr-1"></i>
                                        <span>Sunset Point, {{ package.place.name }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                        {% endfor %}
                    </div>
                </div>

                <!-- Food & Accommodation Details -->
                <div class="bg-white rounded-2xl shadow-xl p-8">
                    <h2 class="text-2xl font-bold mb-6 text-gray-900">Food & Accommodation</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <!-- Food Details -->
                        <div>
                            <h3 class="text-xl font-semibold mb-4 flex items-center">
                                <i class="fas fa-utensils text-green-600 mr-2"></i>Meal Plan
                            </h3>
                            <div class="space-y-4">
                                <div class="bg-green-50 rounded-lg p-4">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="font-medium">Breakfast</span>
                                        <span class="text-sm text-gray-600">7:00 AM - 9:00 AM</span>
                                    </div>
                                    <p class="text-sm text-gray-700">Continental breakfast with local specialties</p>
                                </div>
                                <div class="bg-green-50 rounded-lg p-4">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="font-medium">Lunch</span>
                                        <span class="text-sm text-gray-600">1:00 PM - 2:30 PM</span>
                                    </div>
                                    <p class="text-sm text-gray-700">Multi-course meal with regional cuisine</p>
                                </div>
                                <div class="bg-green-50 rounded-lg p-4">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="font-medium">Dinner</span>
                                        <span class="text-sm text-gray-600">8:00 PM - 9:30 PM</span>
                                    </div>
                                    <p class="text-sm text-gray-700">Traditional dinner with cultural experience</p>
                                </div>
                            </div>
                        </div>

                        <!-- Accommodation Details -->
                        <div>
                            <h3 class="text-xl font-semibold mb-4 flex items-center">
                                <i class="fas fa-bed text-blue-600 mr-2"></i>Accommodation
                            </h3>
                            <div class="bg-blue-50 rounded-lg p-4">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="font-medium">Hotel Category</span>
                                    <span class="text-sm text-gray-600">3-Star Premium</span>
                                </div>
                                <p class="text-sm text-gray-700 mb-3">Comfortable accommodation with modern amenities</p>
                                <ul class="text-sm text-gray-700 space-y-1">
                                    <li><i class="fas fa-check text-green-500 mr-2"></i>AC Rooms with mountain view</li>
                                    <li><i class="fas fa-check text-green-500 mr-2"></i>Free WiFi & parking</li>
                                    <li><i class="fas fa-check text-green-500 mr-2"></i>24/7 room service</li>
                                    <li><i class="fas fa-check text-green-500 mr-2"></i>Restaurant & bar</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Viewpoints & Attractions -->
                <div class="bg-white rounded-2xl shadow-xl p-8">
                    <h2 class="text-2xl font-bold mb-6 text-gray-900">Viewpoints & Attractions</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-gradient-to-br from-blue-500 to-purple-600 text-white rounded-lg p-6">
                            <h3 class="text-xl font-bold mb-3">Sunrise Point</h3>
                            <p class="text-blue-100 mb-4">Best location to witness the magical sunrise over the mountains</p>
                            <div class="flex items-center justify-between">
                                <span class="text-sm">Best Time: 6:00 AM</span>
                                <span class="bg-white/20 px-3 py-1 rounded-full text-sm">Free Entry</span>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-br from-orange-500 to-red-600 text-white rounded-lg p-6">
                            <h3 class="text-xl font-bold mb-3">Sunset Point</h3>
                            <p class="text-orange-100 mb-4">Spectacular sunset views with panoramic mountain vistas</p>
                            <div class="flex items-center justify-between">
                                <span class="text-sm">Best Time: 6:30 PM</span>
                                <span class="bg-white/20 px-3 py-1 rounded-full text-sm">Free Entry</span>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-br from-green-500 to-teal-600 text-white rounded-lg p-6">
                            <h3 class="text-xl font-bold mb-3">Valley View</h3>
                            <p class="text-green-100 mb-4">Breathtaking valley views with lush greenery and waterfalls</p>
                            <div class="flex items-center justify-between">
                                <span class="text-sm">Best Time: All Day</span>
                                <span class="bg-white/20 px-3 py-1 rounded-full text-sm">₹50 Entry</span>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-br from-purple-500 to-pink-600 text-white rounded-lg p-6">
                            <h3 class="text-xl font-bold mb-3">Mountain Peak</h3>
                            <p class="text-purple-100 mb-4">Highest viewpoint offering 360-degree panoramic views</p>
                            <div class="flex items-center justify-between">
                                <span class="text-sm">Best Time: 5:00 PM</span>
                                <span class="bg-white/20 px-3 py-1 rounded-full text-sm">₹100 Entry</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="lg:col-span-1 space-y-6">
                <!-- Quick Booking -->
                <div class="bg-white rounded-2xl shadow-xl p-6 sticky top-6">
                    <h3 class="text-xl font-bold mb-4">Book This Trip</h3>
                    
                    <div class="space-y-4">
                                                 <div class="bg-blue-50 rounded-lg p-4">
                             <div class="text-2xl font-bold text-blue-600 mb-1" id="sidebar-total">₹{{ package.base_price|add:package.base_price|add:1000 }}</div>
                             <div class="text-sm text-gray-600">Total for your group</div>
                         </div>
                        
                        <button type="button" id="book-now-btn" 
                                class="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-purple-600 hover:to-pink-600 text-white py-3 px-6 rounded-lg font-semibold transition-all duration-300 transform hover:scale-105">
                            <i class="fas fa-calendar-check mr-2"></i>View Trip Summary
                        </button>
                        
                        <div class="text-center">
                            <a href="{% url 'packages:package_detail' package.id %}" class="text-blue-600 hover:text-blue-800 font-medium">
                                <i class="fas fa-info-circle mr-1"></i>View Package Details
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Weather Forecast -->
                <div class="bg-white rounded-2xl shadow-xl p-6">
                    <h3 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-cloud-sun text-yellow-500 mr-2"></i>Weather Forecast
                    </h3>
                    <div id="weather-forecast" class="space-y-3">
                        <!-- Weather data will be loaded here -->
                        <div class="text-center text-gray-500">
                            <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                            <p>Loading weather data...</p>
                        </div>
                    </div>
                </div>

                <!-- Package Highlights -->
                <div class="bg-white rounded-2xl shadow-xl p-6">
                    <h3 class="text-xl font-bold mb-4">Package Highlights</h3>
                    <ul class="space-y-3">
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-green-500 mr-3 mt-1"></i>
                            <span class="text-gray-700">Professional tour guide</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-green-500 mr-3 mt-1"></i>
                            <span class="text-gray-700">All meals included</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-green-500 mr-3 mt-1"></i>
                            <span class="text-gray-700">Comfortable accommodation</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-green-500 mr-3 mt-1"></i>
                            <span class="text-gray-700">Transportation included</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-green-500 mr-3 mt-1"></i>
                            <span class="text-gray-700">All entry fees covered</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-green-500 mr-3 mt-1"></i>
                            <span class="text-gray-700">24/7 support</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const startDate = document.getElementById('start-date');
    const endDate = document.getElementById('end-date');
    const groupSize = document.getElementById('group-size');
    const decreaseBtn = document.getElementById('decrease-group');
    const increaseBtn = document.getElementById('increase-group');
    const foodPreferences = document.querySelectorAll('input[name="food_preference"]');
    
    const basePrice = {{ package.base_price }};
    const durationDays = {{ package.duration_days }};
    
    // Set minimum date to today
    const today = new Date().toISOString().split('T')[0];
    startDate.min = today;
    
    // Update end date when start date changes
    startDate.addEventListener('change', function() {
        if (this.value) {
            const start = new Date(this.value);
            const end = new Date(start);
            end.setDate(start.getDate() + durationDays - 1);
            endDate.value = end.toISOString().split('T')[0];
            updatePricing();
        }
    });
    
    // Group size controls
    decreaseBtn.addEventListener('click', function() {
        let currentSize = parseInt(groupSize.textContent);
        if (currentSize > 1) {
            groupSize.textContent = currentSize - 1;
            updatePricing();
        }
    });
    
    increaseBtn.addEventListener('click', function() {
        let currentSize = parseInt(groupSize.textContent);
        if (currentSize < 20) {
            groupSize.textContent = currentSize + 1;
            updatePricing();
        }
    });
    
    // Food preference change
    foodPreferences.forEach(radio => {
        radio.addEventListener('change', updatePricing);
    });
    
    function updatePricing() {
        const currentGroupSize = parseInt(groupSize.textContent);
        const selectedFood = document.querySelector('input[name="food_preference"]:checked').value;
        
        // Seasonal adjustment (mock calculation)
        let seasonalMultiplier = 1.0;
        
        if (startDate.value) {
            const start = new Date(startDate.value);
            const month = start.getMonth();
            
            if (month >= 10 || month <= 2) { // Winter
                seasonalMultiplier = 1.2;
            } else if (month >= 3 && month <= 5) { // Summer
                seasonalMultiplier = 0.8;
            } else { // Monsoon
                seasonalMultiplier = 0.9;
            }
        }
        
        // Group discount
        let groupDiscount = 0;
        if (currentGroupSize >= 4) groupDiscount = 0.1;
        else if (currentGroupSize >= 2) groupDiscount = 0.05;
        
        // Food cost
        let foodCost = 0;
        switch(selectedFood) {
            case 'veg': foodCost = 500; break;
            case 'non_veg': foodCost = 800; break;
            case 'mixed': foodCost = 650; break;
        }
        
        // Calculate prices
        const seasonalAdjustment = basePrice * (seasonalMultiplier - 1);
        const groupDiscountAmount = basePrice * groupDiscount;
        const totalPerPerson = basePrice + seasonalAdjustment - groupDiscountAmount + foodCost;
        const totalGroup = totalPerPerson * currentGroupSize;
        
        // Update display
        document.getElementById('seasonal-adjustment').textContent = `₹${seasonalAdjustment.toFixed(0)}`;
        document.getElementById('group-discount').textContent = `-₹${groupDiscountAmount.toFixed(0)}`;
        document.getElementById('food-cost').textContent = `₹${foodCost}`;
        document.getElementById('total-per-person').textContent = `₹${totalPerPerson.toFixed(0)}`;
        document.getElementById('total-group').textContent = `₹${totalGroup.toFixed(0)}`;
        document.getElementById('sidebar-total').textContent = `₹${totalGroup.toFixed(0)}`;
        
        // Update trip summary section
        updateTripSummary();
    }
    
    function updateTripSummary() {
        const tripSummary = document.getElementById('trip-summary');
        const currentGroupSize = parseInt(groupSize.textContent);
        const selectedFood = document.querySelector('input[name="food_preference"]:checked').value;
        const totalPrice = document.getElementById('total-group').textContent;
        
        // Show/hide trip summary based on whether start date is selected
        if (startDate.value) {
            tripSummary.classList.remove('hidden');
            
            // Update summary content
            document.getElementById('summary-group-size').textContent = `${currentGroupSize} People`;
            document.getElementById('summary-start-date').textContent = startDate.value;
            document.getElementById('summary-end-date').textContent = endDate.value;
            document.getElementById('summary-food').textContent = selectedFood.replace('_', ' ').toUpperCase();
            document.getElementById('summary-total').textContent = totalPrice;
        } else {
            tripSummary.classList.add('hidden');
        }
    }
    
    // Book now button
    document.getElementById('book-now-btn').addEventListener('click', function() {
        if (!startDate.value) {
            alert('Please select a start date first!');
            return;
        }
        
        // Show trip summary modal instead of redirecting
        showTripSummary();
    });
    
    function showTripSummary() {
        const currentGroupSize = parseInt(groupSize.textContent);
        const selectedFood = document.querySelector('input[name="food_preference"]:checked').value;
        const totalPrice = document.getElementById('total-group').textContent;
        
        // Create and show modal with trip summary
        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
        modal.innerHTML = `
            <div class="bg-white rounded-2xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">Trip Summary</h2>
                    <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <div class="space-y-6">
                    <!-- Trip Details -->
                    <div class="bg-blue-50 rounded-lg p-4">
                        <h3 class="font-semibold text-gray-900 mb-2">Trip Details</h3>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>
                                <span class="text-gray-600">Package:</span>
                                <span class="font-medium">{{ package.name }}</span>
                            </div>
                            <div>
                                <span class="text-gray-600">Destination:</span>
                                <span class="font-medium">{{ package.place.name }}</span>
                            </div>
                            <div>
                                <span class="text-gray-600">Duration:</span>
                                <span class="font-medium">{{ package.duration_days }} Days</span>
                            </div>
                            <div>
                                <span class="text-gray-600">Group Size:</span>
                                <span class="font-medium">${currentGroupSize} People</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Dates -->
                    <div class="bg-green-50 rounded-lg p-4">
                        <h3 class="font-semibold text-gray-900 mb-2">Travel Dates</h3>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>
                                <span class="text-gray-600">Start Date:</span>
                                <span class="font-medium">${startDate.value}</span>
                            </div>
                            <div>
                                <span class="text-gray-600">End Date:</span>
                                <span class="font-medium">${endDate.value}</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Food & Pricing -->
                    <div class="bg-yellow-50 rounded-lg p-4">
                        <h3 class="font-semibold text-gray-900 mb-2">Food & Pricing</h3>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>
                                <span class="text-gray-600">Food Preference:</span>
                                <span class="font-medium">${selectedFood.replace('_', ' ').toUpperCase()}</span>
                            </div>
                            <div>
                                <span class="text-gray-600">Total Price:</span>
                                <span class="font-bold text-lg text-blue-600">${totalPrice}</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- What's Included -->
                    <div class="bg-purple-50 rounded-lg p-4">
                        <h3 class="font-semibold text-gray-900 mb-2">What's Included</h3>
                        <ul class="text-sm space-y-1">
                            <li><i class="fas fa-check text-green-500 mr-2"></i>Professional tour guide</li>
                            <li><i class="fas fa-check text-green-500 mr-2"></i>All meals (${selectedFood.replace('_', ' ').toUpperCase()})</li>
                            <li><i class="fas fa-check text-green-500 mr-2"></i>Comfortable accommodation</li>
                            <li><i class="fas fa-check text-green-500 mr-2"></i>Transportation throughout the trip</li>
                            <li><i class="fas fa-check text-green-500 mr-2"></i>All entry fees and permits</li>
                            <li><i class="fas fa-check text-green-500 mr-2"></i>24/7 support during the trip</li>
                        </ul>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="flex space-x-4 pt-4">
                        <button onclick="this.closest('.fixed').remove()" 
                                class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                            Continue Planning
                        </button>
                        <button onclick="proceedToBooking()" 
                                class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-center">
                            Proceed to Book
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        
        // Close modal when clicking outside
        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                modal.remove();
            }
        });
    }
    
    // Make proceedToBooking function globally accessible
    window.proceedToBooking = function() {
        const params = new URLSearchParams({
            package_id: {{ package.id }},
            start_date: startDate.value,
            end_date: endDate.value,
            group_size: groupSize.textContent,
            food_preference: document.querySelector('input[name="food_preference"]:checked').value
        });
        
        window.location.href = `{% url 'create_booking' package.id %}?${params.toString()}`;
    };
    
    // Load weather forecast
    loadWeatherForecast();
    
    function loadWeatherForecast() {
        // Mock weather data - in real implementation, this would call an API
        const weatherData = [
            { day: 'Today', temp: '28°C', condition: 'Sunny', icon: 'fa-sun' },
            { day: 'Tomorrow', temp: '26°C', condition: 'Partly Cloudy', icon: 'fa-cloud-sun' },
            { day: 'Day 3', temp: '24°C', condition: 'Light Rain', icon: 'fa-cloud-rain' },
            { day: 'Day 4', temp: '27°C', condition: 'Sunny', icon: 'fa-sun' },
            { day: 'Day 5', temp: '29°C', condition: 'Clear', icon: 'fa-sun' }
        ];
        
        const weatherContainer = document.getElementById('weather-forecast');
        weatherContainer.innerHTML = weatherData.map(day => `
            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                <div>
                    <div class="font-medium text-gray-900">${day.day}</div>
                    <div class="text-sm text-gray-600">${day.condition}</div>
                </div>
                <div class="flex items-center">
                    <i class="fas ${day.icon} text-yellow-500 mr-2"></i>
                    <span class="font-semibold">${day.temp}</span>
                </div>
            </div>
        `).join('');
    }
    
    // Initialize pricing
    updatePricing();
    
    // Initialize trip summary
    updateTripSummary();
});
</script>
{% endblock %}
